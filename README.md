# 商品监控与推送系统

一个自动化的商品监控系统，用于监控指定网站的商品变化，筛选符合条件的商品，并通过企业微信机器人推送通知。

## 功能特性

- 🔍 **实时监控**：定时检查商品列表，自动检测新增和更新的商品
- 🎯 **智能筛选**：多维度过滤（品牌、尺码、价格、人数）
- 🔄 **冷却机制**：防止同一商品重复推送（3.5天冷却期）
- 📱 **微信推送**：自动发送商品信息到企业微信群
- ⚡ **并发处理**：多线程并发获取商品详情，提高效率
- 💾 **数据持久化**：JSON文件存储商品状态和历史记录

## 项目结构

```
.
├── main.py                 # 主入口文件
├── base_login.py           # 登录认证模块（验证码识别）
├── product_monitor.py      # 商品监控核心模块
├── detail_processor.py     # 商品详情处理模块
├── data_initializer.py     # 数据初始化模块
├── wechat_bot.py          # 企业微信机器人模块
├── initial_products_data.json  # 商品数据存储
├── cooldown_state.json     # 冷却状态记录
├── daily_counter.json      # 每日计数器
└── .gitignore             # Git忽略文件
```

## 核心模块说明

### 1. main.py
程序入口，负责初始化数据并启动监控。

### 2. base_login.py
- 处理登录认证
- 集成第三方验证码识别API（图图识别）
- 自动获取并更新JSESSIONID

### 3. product_monitor.py
核心监控模块，负责：
- 定时获取商品列表
- 检测商品变化（新增/更新）
- 管理冷却机制
- 协调其他模块处理商品

### 4. detail_processor.py
商品详情处理模块：
- 获取商品详情页
- 解析尺码、价格、人数信息
- 应用筛选规则
- 格式化输出

### 5. data_initializer.py
首次运行时的数据初始化，获取所有商品并保存快照。

### 6. wechat_bot.py
企业微信机器人集成：
- 支持多个webhook轮询发送
- 支持文本和图片消息
- 根据订单数量选择不同的机器人组

## 筛选规则

- **品牌过滤**：排除指定品牌（如FILA、HOKA、Saucony等）
- **尺码过滤**：仅保留35.5-45尺码
- **价格过滤**：270-1800元或价格为0
- **人数过滤**：仅保留人数>0的尺码
- **单零价保护**：新增商品且仅一个尺码为0价时，不推送（整款单码除外）

## 配置参数

- **冷却天数**：`COOLDOWN_DAYS = 3.5`
- **监控间隔**：`check_interval = 5` 秒
- **价格范围**：270-1800 元
- **允许尺码**：35.5-45
- **最大工作线程**：8（监控）/ 10（初始化）

## 使用方法

1. **首次运行**：
   ```bash
   python main.py
   ```
   程序会自动检测并初始化数据。

2. **配置微信机器人**：
   在 `wechat_bot.py` 中配置企业微信webhook地址。

3. **配置登录信息**：
   在 `base_login.py` 中配置登录账号和验证码识别API密钥。

## 数据文件说明

- `initial_products_data.json`：存储所有商品的完整信息
- `cooldown_state.json`：存储商品冷却状态（货号/ID -> 时间戳）
- `daily_counter.json`：存储每日计数器（用于生成商品编号）
- `products_output.txt`：推送的商品信息记录（不提交到仓库）

## 依赖库

- `requests` - HTTP请求
- `beautifulsoup4` - HTML解析
- `concurrent.futures` - 并发处理

安装依赖：
```bash
pip install requests beautifulsoup4
```

## 注意事项

- 首次运行需要初始化数据，可能需要较长时间
- 确保网络连接稳定
- 验证码识别API需要有效密钥
- 企业微信webhook需要正确配置

## 许可证

本项目仅供学习和研究使用。


